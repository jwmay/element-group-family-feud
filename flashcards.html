<html>

	<head>
		<title>AP Chemistry Flashcards</title>
		<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
		<link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.green-orange.min.css">
		<style>
			body {
				font-family: sans-serif;
				font-size: 24px;
				line-height: 40px;
			}
			
			.container {
				width: 100%;
				margin: 0 auto;
			}
			
			.mdl-switch {
				margin-top: 6px;
			}
			
			.mdl-layout__drawer-button .material-icons {
				margin-top: 8px;
			}
			
			.mdl-navigation__text {
				padding: 16px 40px;
			}
			
			.mdl-navigation__text li {
				margin-left: -22px;
				margin-bottom: 20px;
				font-size: 16px;
				line-height: 22px;
			}
			
			.mdl-grid {
				margin-top: -16px;
			}
			
			.mdl-card {
				width: 500px;
				height: 300px;
				margin: 40px auto;
			}
			
			.mdl-card__supporting-text {
				text-align: center;
				font-size: 48px;
				height: 100%;
				width: 468px;
				line-height: 216px;
				cursor: pointer;
			}
			
			@media only screen and (max-device-width: 414px) and (orientation: portrait) {
				.mdl-layout__header {
					height: 120px;
				}
				.mdl-layout__header-row {
					height: 120px;
					margin-left: 40px;
				}
				.mdl-layout-title {
					font-size: 60px;
				}
				.mdl-layout__header .mdl-layout__drawer-button {
					height: 80px;
					width: 80px;
					margin-top: 10px;
				}
				.mdl-layout__drawer {
					width: 540px;
					transform: translateX(-550px);
				}
				.mdl-layout__drawer .mdl-layout-title {
					margin: 40px 10px 0px 10px;
				}
				.mdl-layout__drawer .mdl-navigation__text h4 {
					font-size: 40px;
					margin-bottom: 40px;
				}
				.mdl-layout__drawer .mdl-navigation__text li {
					font-size: 36px;
					line-height: 40px;
					margin-left: 6px;
				}
				.mdl-layout__drawer-button .material-icons {
					font-size: 80px;
				}
				.mdl-layout__content {
					margin-top: -120px;
				}
				.mdl-card {
					width: 100%;
					height: 100%;
					margin: 0;
				}
				.mdl-card__supporting-text {
					width: 100%;
					padding: 0;
					padding-top: 480px;
					font-size: 120px;
				}
				.mdl-card__actions .mdl-button {
					height: 180px;
					font-size: 60px;
					line-height: 120px;
				}
				.mdl-card__actions .mdl-switch .mdl-switch__label {
					height: 180px;
					font-size: 40px;
					line-height: 120px;
					left: 94px;
				}
				.mdl-card__actions .mdl-switch .mdl-switch__track {
					height: 42px;
					width: 108px;
					border-radius: 42px;
					top: 35px;
				}
				.mdl-card__actions .mdl-switch .mdl-switch__thumb {
					height: 60px;
					width: 60px;
					top: 28px;
				}
				.mdl-card__actions .mdl-switch.is-checked .mdl-switch__thumb {
					left: 56px;
				}
			}

		</style>
	</head>

	<body>
		<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
			<header class="mdl-layout__header">
				<div class="mdl-layout__header-row">
					<span class="mdl-layout-title">AP Chemistry Flashcards</span>
				</div>
			</header>

			<div class="mdl-layout__drawer">
				<span class="mdl-layout-title">Flashcards</span>
				<nav class="mdl-navigation">
					<div class="mdl-navigation__text">
						<h4>Instructions</h4>
						<ul>
							<li>Click anywhere on the card to flip it over or to move on to the next card.</li>
							<li>When you run out of cards, click the <strong>Shuffle</strong> button.</li>
							<li>To reverse the cards click the <strong>Reverse cards</strong> switch</li>
						</ul>
					</div>
				</nav>
			</div>

			<main class="mdl-layout__content">
				<div class="container">
					<div class="mdl-card mdl-shadow--4dp mdl-card--card-display" id="card">
						<div class="mdl-card__supporting-text" id="cardText"></div>
						<div class="mdl-card__actions mdl-card--border">
							<div class="mdl-grid">
								<div class="mdl-cell mdl-cell--3-col">
									<a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" id="shuffleButton">Shuffle</a>
								</div>
								<div class="mdl-cell mdl-cell--5-col mdl-cell--4-offset" id="reverseToggle">
									<label class="mdl-switch mdl-js-switch" for="reverseSwitch">
										<input type="checkbox" id="reverseSwitch" class="mdl-switch__input">
										<span class="mdl-switch__label">Reverse cards</span>
									</label>
								</div>
							</div>
						</div>
					</div>

					<div class="mdl-shadow--4dp" id="deckSelector">
						<div class="mdl-grid">
							<div class="mdl-cell mdl-cell--6-col">
								<a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" id="ionDeckButton">Ions</a>
							</div>
							<div class="mdl-cell mdl-cell--6-col">
								<a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" id="unitDeckButton">Units</a>
							</div>
						</div>
					</div>

					<!-- Notification display -->
					<div class="mdl-js-snackbar mdl-snackbar" aria-live="assertive" aria-atomic="true" aria-relevant="text">
						<div class="mdl-snackbar__text" style="width:100%;text-align:center;"></div>
						<button class="mdl-snackbar__action" type="button"></button>
					</div>
				</div>
			</main>
		</div>

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
		<script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script>
		<script>
			$(document).ready(function() {
				// Set the default deck; store the default decks and their cards.
				var DEFAULT_DECK = "Ions";
				var DEFAULT_DECKS = [
					{
						name: "Ions",
						allow_reverse: true,
						generator: function() {
							var deck = [
								new Card("mercury (I)", "Hg<sub>2</sub><sup>2+</sup>"),
								new Card("ammonium", "NH<sub>4</sub><sup>+</sup>"),
								new Card("nitrite", "NO<sub>2</sub><sup>-</sup>"),
								new Card("nitrate", "NO<sub>3</sub><sup>-</sup>"),
								new Card("sulfite", "SO<sub>3</sub><sup>2-</sup>"),
								new Card("sulfate", "SO<sub>4</sub><sup>2-</sup>"),
								new Card("bisulfate", "HSO<sub>4</sub><sup>2-</sup>"),
								new Card("hydroxide", "OH<sup>-</sup>"),
								new Card("cyanide", "CN<sup>-</sup>"),
								new Card("hydrogen phosphate", "HPO<sub>4</sub><sup>2-</sup>"),
								new Card("dihydrogen phosphate", "H<sub>2</sub>PO<sub>4</sub><sup>-</sup>"),
								new Card("thiocyanate", "SCN<sup>-</sup>"),
								new Card("carbonate", "CO<sub>3</sub><sup>2-</sup>"),
								new Card("bicarbonate", "HCO<sub>3</sub><sup>-</sup>"),
								new Card("hypochlorite", "ClO<sup>-</sup>"),
								new Card("chlorite", "ClO<sub>2</sub><sup>-</sup>"),
								new Card("chlorate", "ClO<sub>3</sub><sup>-</sup>"),
								new Card("perchlorate", "ClO<sub>4</sub><sup>-</sup>"),
								new Card("acetate", "C<sub>2</sub>H<sub>3</sub>O<sub>2</sub><sup>-</sup>"),
								new Card("permanganate", "MnO<sub>4</sub><sup>-</sup>"),
								new Card("dichromate", "Cr<sub>2</sub>O<sub>7</sub><sup>2-</sup>"),
								new Card("chromate", "CrO<sub>4</sub><sup>-</sup>"),
								new Card("peroxide", "O<sub>2</sub><sup>2-</sup>"),
								new Card("oxalate", "C<sub>2</sub>O<sub>4</sub><sup>2-</sup>"),
								new Card("thiosulfate", "S<sub>2</sub>O<sub>3</sub><sup>2-</sup>"),
							];
							return deck;
						}
					},
					{
						name: "Units",
						allow_reverse: false,
						generator: function() {
							var deck = [
								new Card("meter (m)", "length"),
								new Card("centimeter (cm)", "length"),
								new Card("millimeter (mm)", "length"),
								new Card("liter (L)", "volume"),
								new Card("milliliter (mL = cm<sup>3</sup>)", "volume"),
								new Card("gram (g)", "mass"),
								new Card("kilogram (kg)", "mass"),
								new Card("milligrams (mg)", "mass"),
								new Card("pascal (Pa)", "pressure"),
								new Card("kilopascal (kPa)", "pressure"),
								new Card("atmosphere (atm)", "pressure"),
								new Card("torr = millimeter of mercury (Torr = mmHg)", "pressure"),
								new Card("degree Celcius (&#8451)", "temperature"),
								new Card("Kelvin (K)", "temperature"),
								new Card("joule (J)", "energy"),
								new Card("kilojoule (kJ)", "energy"),
								new Card("hertz (Hz) = 1/s = s<sup>-1</sup>", "frequency"),
								new Card("second (s)", "time"),
								new Card("minute (min)", "time"),
								new Card("(mass/volume) = g/cm<sup>3</sup>", "density"),
								new Card("molarity (M) = mol/L", "concentration"),
								new Card("mole (mol)", "quantity"),
								new Card("amp (A)", "current"),
								new Card("coulomb (C)", "charge"),
								new Card("volt (V)", "potential"),
							];
							return deck;
						}
					},
				];
				
				class Card {
					constructor(aSide, bSide) {
						this._aSide = aSide;
						this._bSide = bSide;

						this.front = this._aSide;
						this.back = this._bSide;
						this.face = this.front;

						// Store the state of the card.
						this.flipped = false;
						this.reversed = false;
					}

					flip() {
						// Reassign the face of the card.
						if (!this.flipped) {
							this.face = this.back;
						} else {
							this.face = this.front;
						}
						this.flipped = !this.flipped;
					}

					reverse() {
						// Reassign the front and back of the card.
						if (!this.reversed) {
							this.front = this._bSide;
							this.back = this._aSide;
						} else {
							this.front = this._aSide;
							this.back = this._bSide;
						}
						this.face = this.front;
						this.reversed = !this.reversed;
					}
				}

				class Deck {
					constructor(name, cards, generator, allow_reverse=true) {
						this.name = name;
						this.cards = cards;
						this.generator = generator;
						this.allow_reverse = allow_reverse;
						this.reversed = false;
					}

					get num_cards() {
						return this.cards.length;
					}

					copy() {
						// Return a copy of the Deck object with
						// a new instance of the cards array.
						var cards = this.generate();
						return new Deck(this.name, cards, this.generator, this.allow_reverse);
					}

					generate() {
						// Return a new instance of the Cards array
						// to reset all flags on all cards.
						return this.generator();
					}

					reverse() {
						if (this.allow_reverse) {
							for (var i = 0; i < this.num_cards; i++) {
								this.cards[i].reverse();
							}
							this.reversed = !this.reversed;
						}
					}

					// Rearrange the cards into a random order.
					shuffle() {
						// An array to store the index number of cards that
						// have been added to the shuffled cards deck.
						var used_cards = [];

						// An array to store the shuffled cards.
						var shuffled_cards = [];
						
						// Loop until all of the cards in the original deck have
						// been randomly shuffled into the shuffled cards deck.
						while (shuffled_cards.length < this.num_cards) {
							var rand_num = Math.floor(Math.random() * this.num_cards);
							var card_used = used_cards.indexOf(rand_num);
							
							// The randomly-selected card is not in our shuffled
							// cards deck, so let's add it to the new deck and
							// update the array of cards that have been used.
							if (card_used == -1) {
								used_cards.push(rand_num);
								shuffled_cards.push(this.cards[rand_num]);
							}
						}
						this.cards = shuffled_cards;
					}
				}

				class Decks {
					constructor(source=DEFAULT_DECKS) {
						this.decks = this.getDecks(source);
					}

					get num_decks() {
						return this.decks.length;
					}

					getDeckByName(name) {
						var deck = jQuery.grep(this.decks, function(e){ return e.name == name; });
						return deck[0];
					}

					getDecks(source) {
						var decks = [];
						for (var i = 0; i < source.length; i++) {
							var name = source[i].name;
							var cards = source[i].generator();
							var generator = source[i].generator;
							var allow_reverse = source[i].allow_reverse;
							decks.push(
								new Deck(name, cards, generator, allow_reverse)
							);
						}
						return decks;
					}
				}

				class Flashcards {
					constructor(deck) {
						// Store the original deck for reuse.
						this.original_deck = deck;

						// Store a working copy of the deck and the current card.
						this.working_deck = deck.copy();
						this.current_card = {};

						// Initialize the first card.
						this.nextCard();

						// Store the state of the flashcards.
						this.reversed = false;
					}

					get num_cards() {
						return this.working_deck.cards.length;
					}

					advance() {
						if (this.current_card) {
							if (this.current_card.flipped) {
								this.nextCard();
							} else {
								this.current_card.flip();
							}
						}
					}

					nextCard() {
						this.current_card = this.working_deck.cards.shift();
					}

					reverse() {
						this.modifyDeck(function() {
							// Reverse the cards if they have not already been reversed.
							if (!this.reversed) {
								this.working_deck.reverse();
							}
							this.reversed = !this.reversed;
						});
					}

					shuffle() {
						this.modifyDeck(function() {
							// Reverse the cards if they were reversed before shuffle.
							if (this.reversed) {
								this.working_deck.reverse();
							}
						});
					}

					modifyDeck(modifier) {
						this.resetDeck();

						// Execute the modifier function.
						modifier.call(this);

						// Shuffle the deck and initialize the first card.
						this.working_deck.shuffle();
						this.nextCard();
					}

					resetDeck() {
						// The working_deck is destroyed as flashcards
						// are advanced, so copy the original deck.
						this.working_deck = this.original_deck.copy();
					}
				}

				class Display {
					constructor() {
						this.cardDisplay = $("#cardText");
						this.notificationDisplay = document.querySelector(".mdl-js-snackbar");
						this.reverseToggle = $("#reverseToggle");

						this.reverse_toggle_visible = this.isVisible(this.reverseToggle);
					}

					reverseToggleDisplay() {
						this.reverseToggle.toggle();
						this.reverse_toggle_visible = this.isVisible(this.reverseToggle);
					}

					update(text) {
						this.cardDisplay.html(text);
					}

					notification(text) {
						var data = {message: text};
						this.notificationDisplay.MaterialSnackbar.showSnackbar(data);
					}

					isVisible(control) {
						return control.is(":visible");
					}
				}

				class FlashcardApp {
					constructor(default_deck=DEFAULT_DECK, default_decks=DEFAULT_DECKS) {
						this.display = new Display();

						// Get and store the decks and the current deck.
						this.decks = new Decks(default_decks);
						this.current_deck = this.decks.getDeckByName(default_deck);

						// Initialize the default deck of flashcards.
						this.flashcards = new Flashcards(this.current_deck);

						// Initialize the display.
						this.showCard(this.flashcards.current_card);
						this.reverseToggleDisplay();
					}

					advance() {
						this.flashcards.advance();
						this.showCard(this.flashcards.current_card);
					}

					changeToDeck(name) {
						this.current_deck = this.decks.getDeckByName(name);
						this.flashcards = new Flashcards(this.current_deck);
						this.reverseToggleDisplay();
						this.showCard(this.flashcards.current_card);
					}

					reverse(notify=true) {
						this.flashcards.reverse();
						this.showCard(this.flashcards.current_card);
						if (notify) {
							this.display.notification("Cards reversed");
						}
					}

					shuffle(notify=true) {
						this.flashcards.shuffle();
						this.showCard(this.flashcards.current_card);
						if (notify) {
							this.display.notification("Cards shuffled");
						}
					}

					reverseToggleDisplay() {
						var unallowed_and_visible = (!this.flashcards.working_deck.allow_reverse &&
													this.display.reverse_toggle_visible);

						var allowed_and_hidden = (this.flashcards.working_deck.allow_reverse &&
											   !this.display.reverse_toggle_visible);

						if (unallowed_and_visible || allowed_and_hidden) {
							this.display.reverseToggleDisplay();
						}
					}

					showCard(card) {
						if (card) {
							this.display.update(card.face);
						} else {
							this.display.update("Out of cards");
						}
					}
				}

				// Create an instance of the flashcard app.
				var app = new FlashcardApp();

				// DOM selectors for controlling the flashcard app.
				var $flashcard = $("#cardText");
    			var $shuffleButton = $("#shuffleButton");
    			var $reverseSwitch = $("#reverseSwitch");
				var $ionDeckButton = $("#ionDeckButton");
				var $unitDeckButton = $("#unitDeckButton");

				// Handle response when flashcard is clicked.
				$flashcard.click(function() {
					app.advance();
				});

    			// Handle response when Shuffle button is clicked.
    			$shuffleButton.click(function() {
	    			app.shuffle();
    			});

				// Handle response when Reverse toggle switch is clicked.
				$reverseSwitch.click(function() {
					app.reverse();
				});

				// Handle response when a deck selector button is clicked.
				$ionDeckButton.click(function() {
					app.changeToDeck("Ions");
				});
				$unitDeckButton.click(function() {
					app.changeToDeck("Units");
				});

				// UNIT TESTING
				var test_decks = [
					{
						name: "Test",
						allow_reverse: false,
						generator: function() {
							var deck = [
								new Card("test_1a", "test_1b"),
								new Card("test_2a", "test_2b"),
								new Card("test_3a", "test_3b"),
								new Card("test_4a", "test_4b"),
							];
							return deck;
						}
					},
				];
			});
		</script>
	</body>

</html>
